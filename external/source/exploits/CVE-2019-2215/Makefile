
MUSL_DIR=~/dev/git/mettle/build/tools/musl-cross/bin/
#MUSL_PREFIX=$(MUSL_DIR)x86_64-linux-musl-
MUSL_PREFIX=$(MUSL_DIR)aarch64-linux-musl-
#MUSL_PREFIX=$(MUSL_DIR)armv5l-linux-musleabi-
MUSL_CC=$(MUSL_PREFIX)cc
MUSL_AS=$(MUSL_PREFIX)as
MUSL_OBJCOPY=$(MUSL_PREFIX)objcopy

all: shellcode

exploit: exploit.c
	$(MUSL_CC) -static -Os -o $@ $^
	cp exploit ../../../../data/exploits/CVE-2019-2215/exploit 

elf2shellcode:
	gcc elf2shellcode.c -o elf2shellcode

loader:
	$(MUSL_AS) loader.s -o loader.o
	$(MUSL_OBJCOPY) -O binary loader.o loader.bin
	cp loader.bin ../../../../data/exploits/CVE-2019-2215/loader

shellcode: exploit loader elf2shellcode
	./elf2shellcode exploit exploit.bin
	cp exploit.bin ../../../../data/exploits/CVE-2019-2215/exploit.bin 

push: exploit
	adb push exploit /data/local/tmp/exploit

install: exploit

clean:
	rm -rf libs
	rm -rf obj

