#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>

#include <mach/mach.h>

#include "common.h"
#include "empty_list.h"

#import <Foundation/Foundation.h>

int main() {
    NSLog(@"XXX Starting exploit\n");

    NSLog(@"XXX Crashing now:\n");
    NSFileManager *fileManager = [NSFileManager defaultManager];
    NSLog(@"XXX Why?\n");

    mach_port_t taskforpidzero = exploit();
    if (!MACH_PORT_VALID(taskforpidzero)) {
      NSLog(@"XXX Exploit failed\n");
      sleep(1);
      return -1;
    }

    NSLog(@"XXX Got tfp0!\n");

    uint64_t sb = 0;
    //init_jelbrek(taskforpidzero);
    
    return 0;
}


uint64_t entry[] = { MAGIC, (uint64_t)&main };
