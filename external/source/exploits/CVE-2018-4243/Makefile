.PHONY: payload/payload.dylib

shellcode.bin: shellcode.s payload/payload.dylib Makefile
	#aarch64-linux-gnu-as -EL -o shellcode.o shellcode.s
	#aarch64-linux-gnu-objcopy -O binary shellcode.o shellcode.bin
	as -arch arm64 shellcode.s -o shellcode.o
	/usr/local/Cellar/binutils/2.31.1_1/bin/gobjcopy -Obinary shellcode.o shellcode.bin
	rm shellcode.o
	dd if=/dev/zero of=shellcode.bin bs=1 count=1 seek=4095
	cat payload/payload.dylib >> shellcode.bin

shellcode.s: shellcode.in.s payload/payload.dylib Makefile
	python gen_shellcode.py

payload/payload.dylib:
	cd payload && make

install: shellcode.bin
	cp shellcode.bin ../../../../data/exploits/CVE-2018-4243/exploit

